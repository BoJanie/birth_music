<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
    <title> Birth Music Program </title>
  </head>
    <body>
        <h1>Birth Music Program</h1>
        <p>by Jane Plomp</p>
        <h3>This program is currently in development </h3>
        <p><b>Currently the program will: </b><br>
            1. Receive inputs for your birthday <br>
            2. Prints your birthday <br>
            3. Play a series of chords based on your birthday <br> <br>
            Try it out if you want! <br>
            Put in your birthday and click the submit button. <br>
            Note: Use zeroes (so if you were born on January fifth type in 01 and 05 instead of 1 and 5)</p>


        Month born:<input id="month">
        Day born:<input id="day">
        Year born:<input id="year">
        <button id="submit">Submit</button>

        <hr> <!--Horizontal line-->
        <div id="birthdayDisplay"></div> <br> <!--what is div?? -->

        <script src="js/tone.js"></script>

        <script>
            //Collect Birthday from User and runs function on it
            function getBirthday() {
                var day = document.getElementById("day").value;
                var month = document.getElementById("month").value;
                var year = document.getElementById("year").value;

                //Verbalizes birthday to make sure it's correct
                var birthday = "You were born " + month + "/" + day + "/" + year + ".";
                document.getElementById("birthdayDisplay").innerHTML = birthday;

                //Turns the birthday into a string that can be used/converted for calculations
                var birthdayString = month + day + year;
                function bdayInt(num){
                  return parseInt(birthdayString.charAt(num));
                }

                var dayInt = parseInt(day);

                //ACTUAL MUSIC PRODUCTION:
                var synth = new Tone.Synth().toMaster();

                //Function to quickly play note:
                function triggerSynth(note,time) {
                  synth.triggerAttackRelease(note,"4n",time);
                };

                //KEYS
                if(month=="01") { //January = C Major
                    var tiNoteL = "B3";
                    var doNote = "C4";
                    var reNote = "D4";
                    var miNote = "E4";
                    var faNote = "F4";
                    var soNote = "G4";
                    var laNote = "A4";
                    var tiNote = "B4";
                    var doNoteH = "C5";
                    var reNoteH = "D5";
                } else if(month=="02") { //February = Db Major
                    var tiNoteL = "C4";
                    var doNote = "Db4";
                    var reNote = "Eb4";
                    var miNote = "F4";
                    var faNote = "Gb4";
                    var soNote = "Ab4";
                    var laNote = "Bb4";
                    var tiNote = "C5";
                    var doNoteH = "Db5";
                    var reNoteH = "Eb5";
                } else if(month=="03") { //March = D Major
                    var tiNoteL = "C#4";
                    var doNote = "D4";
                    var reNote = "E4";
                    var miNote = "F#4";
                    var faNote = "G4";
                    var soNote = "A4";
                    var laNote = "B4";
                    var tiNote = "C#5";
                    var doNoteH = "D5";
                    var reNoteH = "E5";
                } else if(month=="04") { //April = Eb Major
                    var tiNoteL = "D4";
                    var doNote = "Eb4";
                    var reNote = "F4";
                    var miNote = "G4";
                    var faNote = "Ab4";
                    var soNote = "Bb4";
                    var laNote = "C5";
                    var tiNote = "D5";
                    var doNoteH = "Eb5";
                    var reNoteH = "F5";
                } else if(month=="05") { //May = E Major
                    var tiNoteL = "D#4";
                    var doNote = "E4";
                    var reNote = "F#4";
                    var miNote = "G#4";
                    var faNote = "A4";
                    var soNote = "B4";
                    var laNote = "C#5";
                    var tiNote = "D#5";
                    var doNoteH = "E5";
                    var reNoteH = "F#5";
                } else if(month=="06") { //June = F Major
                    var tiNoteL = "E4";
                    var doNote = "F4";
                    var reNote = "G4";
                    var miNote = "A4";
                    var faNote = "Bb4";
                    var soNote = "C5";
                    var laNote = "D5";
                    var tiNote = "E5";
                    var doNoteH = "F5";
                    var reNoteH = "G5";
                } else if(month=="07") { //July = Gb Major
                    var tiNoteL = "F4";
                    var doNote = "Gb4";
                    var reNote = "Ab4";
                    var miNote = "Bb4";
                    var faNote = "B4";
                    var soNote = "Db5";
                    var laNote = "Eb5";
                    var tiNote = "F5";
                    var doNoteH = "Gb5";
                    var reNoteH = "Ab5";
                } else if(month=="08") { //August = G Major
                    var tiNoteL = "F#4";
                    var doNote = "G4";
                    var reNote = "A4";
                    var miNote = "B4";
                    var faNote = "C5";
                    var soNote = "D5";
                    var laNote = "E5";
                    var tiNote = "F#5";
                    var doNoteH = "G5";
                    var reNoteH = "A5";
                } else if(month=="09") { //September = Ab Major
                    var tiNoteL = "G3";
                    var doNote = "Ab3";
                    var reNote = "Bb3";
                    var miNote = "C4";
                    var faNote = "Db4";
                    var soNote = "Eb4";
                    var laNote = "F4";
                    var tiNote = "G4";
                    var doNoteH = "Ab4";
                    var reNoteH = "Bb4";
                } else if(month=="10") { //October = A Major
                    var tiNoteL = "G#3";
                    var doNote = "A3";
                    var reNote = "B3";
                    var miNote = "C#4";
                    var faNote = "D4";
                    var soNote = "E4";
                    var laNote = "F#4";
                    var tiNote = "G#4";
                    var doNoteH = "A4";
                    var reNoteH = "B4";
                } else if(month=="11") { //November= Bb Major
                    var tiNoteL = "A3";
                    var doNote = "Bb3";
                    var reNote = "C4";
                    var miNote = "D4";
                    var faNote = "Eb4";
                    var soNote = "F4";
                    var laNote = "G4";
                    var tiNote = "A4";
                    var doNoteH = "Bb4";
                    var reNoteH = "C5";
                } else if(month=="12") { //December= B Major
                    var tiNoteL = "A#3";
                    var doNote = "B3";
                    var reNote = "C#4";
                    var miNote = "D#4";
                    var faNote = "E4";
                    var soNote = "F#4";
                    var laNote = "G#4";
                    var tiNote = "A#4";
                    var doNoteH = "B4";
                    var reNoteH = "C#5";
                }

                //This function will convert a single digit number to solfege:
                function convertNumberToSolfege(num) {
                  if(num=='0') {
                    return tiNoteL;
                  } else if(num=='1') {
                    return doNote;
                  } else if(num=='2') {
                    return reNote;
                  } else if(num=='3') {
                    return miNote;
                  } else if(num=='4') {
                    return faNote;
                  } else if(num=='5') {
                    return soNote;
                  } else if(num=='6') {
                    return laNote;
                  } else if(num=='7') {
                    return tiNote;
                  } else if(num=='8') {
                    return doNoteH;
                  } else if(num=='9') {
                    return reNoteH;
                  } else {
                    return "";
                    console.log("You need to use numbers!!")
                  }
                }

                //Convert numbers to solfege using function above, store in array to play
                var i
                var notes = [];
                var notesNumbers = [];
                //First section:
                for(i=0; i<birthdayString.length; i++) {
                  notes.push(convertNumberToSolfege(bdayInt(i)));
                  notesNumbers.push(bdayInt(i));
                }
                //Second section will be raised by:
                var change = year%6 + 1
                //Second section, same but up a third:
                for(i=0; i<birthdayString.length; i++) {
                  notes.push(convertNumberToSolfege((bdayInt(i)+change)%10));
                  notesNumbers.push((bdayInt(i)+change)%10);
                }
                //Repeat of first:
                for(i=0; i<birthdayString.length; i++) {
                  notes.push(convertNumberToSolfege(bdayInt(i)));
                  notesNumbers.push(bdayInt(i));
                }
                //Array ends with a do, based on how high last note is
                var lastNote = notes[notes.length-1]
                if(lastNote==tiNote || lastNote==doNoteH || lastNote==reNoteH) {
                  notes.push(doNoteH)
                  notesNumbers.push(8);
                } else {
                  notes.push(doNote)
                  notesNumbers.push(1);
                }
                console.log(notesNumbers);

                //CHORDS!! Make a polysynth First
                //var polySynth = newTone.PolySynth(4,Tone.synth).toMaster()
                //Find the THIRD
                var thirds = [];
                for(i=0;i<notesNumbers.length; i++) {
                  //Third below high do:
                  if(notesNumbers[i] > 7) {
                    var thirdTemp = notesNumbers[i]-5;
                    thirds.push(convertNumberToSolfege(thirdTemp));
                  } else { //Third above high do needs to go down:
                    var thirdTemp = (notesNumbers[i]+2)%10;
                    thirds.push(convertNumberToSolfege(thirdTemp));
                  }
                }

                //Find the FIFTH
                var fifths = [];
                for(i=0;i<notesNumbers.length; i++) {
                  //Fifth below so:
                  if(notesNumbers[i] > 5) {
                    var fifthTemp = notesNumbers[i]-3;
                    fifths.push(convertNumberToSolfege(fifthTemp));
                  } else { //fifth above so needs to go down:
                    var fifthTemp = (notesNumbers[i]+4)%10;
                    fifths.push(convertNumberToSolfege(fifthTemp));
                  }
                }

                //ISSUE!!! On my computer Firefox, if notes.length>6, will not play notes after that. notes.length>7=not play at all (CPU goes whack)

                const now = 0.50+Tone.now();
                //Set a time duration (tempo) based on day born
                var dur = 1 + dayInt*0.025;

                //PLAY CHORDS!!
                //make polysynth first...
                var polySynth = new Tone.PolySynth(3, Tone.Synth).toMaster();

                //The emphasis array will help us decide what note=chord vs arpeggios
                emphasis = [];
                for(i=0; i < 4; i++) {
                  beatOne = now + dur*i
                  beatTwo = now + dur*i + dur/4
                  beatThree = now + dur*i + 2*dur/4
                  beatFour = now + dur*i + 3*dur/4
                  //For the first half of the song:
                  if(year%2 == 0) { //Year is even, chord on 1
                    emphasis.push([beatOne, beatTwo, beatThree, beatFour])
                  } else { //Year is odd, chord on 3
                    emphasis.push([beatThree, beatOne, beatTwo, beatFour])
                  }
                }
                for(i=4; i < notes.length; i++) {
                  beatOne = now + dur*i
                  beatTwo = now + dur*i + dur/4
                  beatThree = now + dur*i + 2*dur/4
                  beatFour = now + dur*i + 3*dur/4
                  //For the second half of the song:
                  if(month > 2 && month < 6) { //Spring! Chord on 1
                    emphasis.push([beatOne, beatTwo, beatThree, beatFour])
                  } else if(month > 5 && month < 9) { //Summer! Chord on 2
                    emphasis.push([beatTwo, beatOne, beatThree, beatFour])
                  } else if(month > 8 && month < 12) { //Fall! Chord on 3
                    emphasis.push([beatThree, beatOne, beatTwo, beatFour])
                  } else if(month == 12 || month < 3) { //Winter! Chord on 4
                    emphasis.push([beatFour, beatOne, beatTwo, beatThree])
                  }
                }

                //This array will determine whether an arpeggio is played or not
                //1= yes arpeggio, 2= no arpeggio
                var arpeggios = [];
                if(day%2 == 0) { //if born on an even numbered day, then this!
                  for(i=0; i < notes.length; i++) {
                    if(i%4 < 2){
                      arpeggios.push(1)
                    } else {
                      arpeggios.push(0)
                    }
                  }
                } else if( //if born on a prime number day, then this!
                  day == 1 || day == 2 || day == 3 || day == 5 ||
                  day == 7 || day == 11 || day == 13 || day == 17 ||
                  day == 19|| day == 23 || day == 29 || day == 31
                ) {
                  for(i=0; i < notes.length; i++) {
                    if((i%4 == 0 || i%4 == 2) && i%8 != 6){
                      arpeggios.push(1)
                    } else {
                      arpeggios.push(0)
                    }
                  }
                } else { //if non=prime odd, then:
                  for(i=0; i < notes.length; i++) {
                    if(i%8 < 4){
                      arpeggios.push(1)
                    } else {
                      arpeggios.push(0)
                    }
                  }
                }


                //Now to actually play the notes!
                var i;
                for(i=0; i < notes.length; i++) {
                  if((arpeggios[i] == 1) && (i != notes.length-1)) { //REPLACE WITH A TRUE/FALSE ARRAY TO CHOOSE WHAT IS ARPEGGIATED!!!!
                    polySynth.triggerAttackRelease([notes[i], thirds[i], fifths[i]], dur/4, emphasis[i][0]);
                    synth.triggerAttackRelease(notes[i], dur/4, emphasis[i][1]);
                    synth.triggerAttackRelease(thirds[i], dur/4, emphasis[i][2]);
                    synth.triggerAttackRelease(fifths[i], dur/4, emphasis[i][3]);
                  } else if(notesNumbers[i] == (notesNumbers[i+1] - 2)) { //If a passing note up makes sense
                    var passingNote = convertNumberToSolfege(notesNumbers[i] + 1);
                    polySynth.triggerAttackRelease([notes[i], thirds[i], fifths[i]], dur/2, now + dur*i)
                    polySynth.triggerAttackRelease([passingNote, thirds[i], fifths[i]], dur/2, now + dur*i + dur/2)
                    console.log("Passing note up at note number: " + (i+1))
                  } else if(notesNumbers[i] == (notesNumbers[i+1] + 2)) { //If a passing note down makes sense
                    var passingNote = convertNumberToSolfege(notesNumbers[i] - 1);
                    polySynth.triggerAttackRelease([notes[i], thirds[i], fifths[i]], dur/2, now + dur*i)
                    polySynth.triggerAttackRelease([passingNote, thirds[i], fifths[i]], dur/2, now + dur*i + dur/2)
                    console.log("Passing note down at note number: " + (i+1))
                  } else { //otherwise just play the chord
                    polySynth.triggerAttackRelease([notes[i], thirds[i], fifths[i]], dur, now + dur*i);
                  }
                };
            };
            document.getElementById('submit').addEventListener('click',getBirthday);


        </script>
    </body>
</html>
